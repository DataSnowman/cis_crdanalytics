<?xml version="1.0" encoding="utf-8" ?>
<Template>
    <Category>DesignPattern</Category>
    <Title>Customer Review Analytics Solution</Title>
    <Owner displayname="Pengzhi Sun" email="Pengzhi.Sun@microsoft.com" />
    <PublishedOn>3/9/2017</PublishedOn>
    <ImageUrl>{PatternAssetBaseUrl}/image.png</ImageUrl>
    <Description>Customer Review Analytics Solution from China Cloud Group.</Description>
    <Summary src="markdown/Summary.md" format="markdown" />
    <EstimatedTime>3 Minutes</EstimatedTime>
    <ProvisioningSteps>
        <ArmDeployment source="arm/CreateSQLdatabaseArm.json" title="Deploying a SQL database ARM template">
            <Parameters>
                <Credential type="sql" username="sqlServerUsername" password="sqlServerPassword" />
            </Parameters>
        </ArmDeployment>
        <Function name="prepsql" title="Preparing the SQL Database">
          <Parameters>
              <Parameter hidden="true" name="sqlServerName" defaultValue="{Outputs.sqlServerName}" />
              <Parameter hidden="true" name="sqlDatabaseName" defaultValue="{Outputs.sqlDatabaseName}" />
              <Parameter hidden="true" name="sqlServerUsername" defaultValue="{Outputs.sqlServerUsername}" />
              <Parameter hidden="true" name="sqlServerPassword" defaultValue="{Outputs.sqlServerPassword}" />
          </Parameters>
        </Function>
        <ArmDeployment source="arm/deployEmotionApp.json" title="Deploying Emotion Web App">
            <Parameters>
                <Parameter name="deployPackageUri" hidden="true" defaultValue="{PatternAssetBaseUrl}\Emotion.zip" />
            </Parameters>
        </ArmDeployment>
        <ArmDeployment source="arm/deployTopicApp.json" title="Deploying Topic Web App">
            <Parameters>
                <Parameter name="deployPackageUri" hidden="true" defaultValue="{PatternAssetBaseUrl}\Topic.zip" />
            </Parameters>
        </ArmDeployment>
        <ArmDeployment source="arm/deployWordsApp.json" title="Deploying Words Web App">
            <Parameters>
                <Parameter name="deployPackageUri" hidden="true" defaultValue="{PatternAssetBaseUrl}\Words.zip" />
            </Parameters>
        </ArmDeployment>
        <SolutionDashboard>
            <Parameters>
                <Parameter hidden="true" name="pbixFileUrl" defaultValue="{PatternAssetBaseUrl}/dashboards/dataChart.pbix" />
                <Parameter hidden="true" name="sqlServer" defaultValue="{Outputs.sqlServerName}" />
                <Parameter hidden="true" name="sqlDatabase" defaultValue="{Outputs.sqlDatabaseName}" />
                <Parameter hidden="true" name="sqlServerUsername" defaultValue="{Outputs.sqlServerUsername}" />
                <Parameter hidden="true" name="sqlServerPassword" defaultValue="{Outputs.sqlServerPassword}" />
            </Parameters>
        </SolutionDashboard>
        <Function name="configpipeline" title="Configuring the Pipeline App">
          <Parameters>
              <Parameter hidden="true" name="sqlServerName" defaultValue="{Outputs.sqlServerName}" />
              <Parameter hidden="true" name="sqlDatabaseName" defaultValue="{Outputs.sqlDatabaseName}" />
              <Parameter hidden="true" name="sqlServerUsername" defaultValue="{Outputs.sqlServerUsername}" />
              <Parameter hidden="true" name="sqlServerPassword" defaultValue="{Outputs.sqlServerPassword}" />
              <Parameter hidden="true" name="emotionAppUrl" defaultValue="{Outputs.emotionAppUrl}" />
              <Parameter hidden="true" name="topicAppUrl" defaultValue="{Outputs.topicAppUrl}" />
              <Parameter hidden="true" name="wordsAppUrl" defaultValue="{Outputs.wordsAppUrl}" />
              <Parameter name="storageAccountName" hidden="true" defaultValue="{Outputs.storageAccountName}">
              <Parameter name="storageAccountKey" hidden="true" defaultValue="{Outputs.storageAccountKey}">
              <Parameter name="containerName" hidden="true" defaultValue="asserts">
          </Parameters>
        </Function>
        <ArmDeployment source="arm/deployPipelineApp.json" title="Deploying Pipeline Web App">
            <Parameters>
                <Parameter name="deployPackageUri" hidden="true" defaultValue="https://{Outputs.storageAccountName}.blob.core.windows.net/asserts/Pipeline.zip" />
            </Parameters>
        </ArmDeployment>
        <Manual title="Done">
            <Instructions src="markdown/Instructions.md" format="markdown" />
        </Manual>
    </ProvisioningSteps>
</Template>